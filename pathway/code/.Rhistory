setwd('/Users/manage/Desktop/Github/PD/pathway/code/')
library(tibble)
degP=c(0.05)
connP=c(0.01)
cutoff=c(0.003)
combine_database=c('bp','reac','bp_no','go,reac','go_no,reac')
is_smooth=c('yesSmooth')
gpsnet_result_path0='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result/'
gpsnet_result_score_path0='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result_keep_score/'
gpsnet_raw_input_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/DEG_data/'
parent_save_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/'
#trait_list='Fibroblasts_filtered,Keratinocytes_filtered,T_cells_filtered,B_cells_filtered'
trait_list='Myofibroblast_filtered'
all_traits=strsplit(trait_list,',')[[1]]
all_summary_list <- list()
setwd('~/Desktop/Github/PD/pathway/code/')
library(tibble)
# ---- Set Path ----
degP=c(0.05)
connP=c(0.01)
cutoff=c(0.003)
combine_database=c('bp','reac','bp_no','go,reac','go_no,reac')
is_smooth=c('yesSmooth')
gpsnet_result_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result/'
gpsnet_result_score_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result_keep_score/'
gpsnet_raw_input_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/DEG_data/'
parent_save_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/'
trait_list='Myofibroblast_filtered'
all_traits=strsplit(trait_list,',')[[1]]
#all_summary_list <- list()
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff)
version='Myofibroblast_0.003'
#version = paste0(subfolder,'_moduleCutoff',cutoff)
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
#all_summary_list <- list()
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff,'_noheader')
version='Myofibroblast_0.003'
#version = paste0(subfolder,'_moduleCutoff',cutoff)
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
gpsnet_result_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result/'
gpsnet_result_score_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result_keep_score/'
gpsnet_raw_input_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/DEG_data/'
parent_save_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/pathway/'
trait_list='Myofibroblast_filtered'
all_traits=strsplit(trait_list,',')[[1]]
#all_summary_list <- list()
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff,'_noheader')
version='Myofibroblast'
gpsnet_result_path
save_path
trait_list
gpsnet_result_suffix
file_path <- paste0(gpsnet_result_path, trait, gpsnet_result_suffix)
file_path <- paste0(gpsnet_result_path, trait_list, gpsnet_result_suffix)
file_path
gpsnet_result_suffix=paste0('_',cutoff,'_noheader.txt')
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
file_path <- paste0(gpsnet_result_path, trait, gpsnet_result_suffix)
file_path <- paste0(gpsnet_result_path, trait_list, gpsnet_result_suffix)
file_path
a=as.vector(read.csv(file_path, header = FALSE)$V1)
gpsnet_result_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result/degP0.05_conn0.01_yesSmooth/'
gpsnet_result_score_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result_keep_score/degP0.05_conn0.01_yesSmooth/'
gpsnet_raw_input_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/DEG_data/'
parent_save_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/pathway/'
trait_list='Myofibroblast_filtered'
all_traits=strsplit(trait_list,',')[[1]]
#all_summary_list <- list()
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff,'_noheader.txt')
version='Myofibroblast'
#version = paste0(subfolder,'_moduleCutoff',cutoff)
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
# GO - no prune
save_path=paste0(parent_save_path,version,'/GO_nogoxplore_norevigo/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_nogoxplore_norevigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
# REAC
save_path=paste0(parent_save_path,version,'/REAC/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_filterREAC.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedREAC <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedREAC_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,num_enrichedREAC)
summary_list[[1]] <- num_enrichedGO
summary_list[[2]] <- num_enrichedBP
summary_list[[3]] <- num_enrichedGO_no
summary_list[[4]] <- num_enrichedBP_no
summary_list[[5]] <- num_enrichedREAC
combine_database_v
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
combined_save_path
combine_database_v=c('bp','reac','bp_no','go,reac','go_no,reac')
for (combine_database in combine_database_v){
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,as.numeric(num_enriched_combo))
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
# ---- Plot Network ----
net_save_path=paste0(parent_save_path,version,'/net_',combine_database,'/')
if (!dir.exists(net_save_path)) {
dir.create(net_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_net.R",gpsnet_result_score_path,gpsnet_raw_input_path,net_save_path,trait_list,gpsnet_result_suffix)
system(cmd)
}
for (combine_database in combine_database_v){
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,as.numeric(num_enriched_combo))
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
# ---- Plot Network ----
net_save_path=paste0(parent_save_path,version,'/net_',combine_database,'/')
if (!dir.exists(net_save_path)) {
dir.create(net_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_net.R",gpsnet_result_score_path,gpsnet_raw_input_path,net_save_path,trait_list,gpsnet_result_suffix)
system(cmd)
}
summary_df <- as.data.frame(t(do.call(rbind, summary_list)))
colnames(summary_df) <- c('GO','BP','GO_no','BP_no','REAC',combine_database_v)
summary_df$degP <- degP
summary_df$connP <- connP
summary_df$moduleCut <- cutoff
summary_df <- rownames_to_column(summary_df, var = "cellType")
summary_df
all_summary_df
gc()
setwd('~/Desktop/Github/PD/pathway/code/')
library(tibble)
# ---- Set Path ----
degP=c(0.05)
connP=c(0.01)
cutoff=c(0.003)
combine_database_v=c('bp','reac','bp_no','go,reac','go_no,reac')
is_smooth=c('yesSmooth')
gpsnet_result_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result/degP0.05_conn0.01_yesSmooth/'
gpsnet_result_score_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/GPSnet_result_keep_score/degP0.05_conn0.01_yesSmooth/'
gpsnet_raw_input_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/DEG_data/'
parent_save_path='~/Desktop/chang_runGPSnet_08-09-2024/20241021-MyofibDEG_EDPMdrug/pathway/'
trait_list='Myofibroblast_filtered'
all_traits=strsplit(trait_list,',')[[1]]
all_summary_list <- list()
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff,'_noheader.txt')
version='Myofibroblast'
#version = paste0(subfolder,'_moduleCutoff',cutoff)
#version = paste0(subfolder,'_moduleCutoff',cutoff)
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
# GO - no prune
save_path=paste0(parent_save_path,version,'/GO_nogoxplore_norevigo/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_nogoxplore_norevigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
# REAC
save_path=paste0(parent_save_path,version,'/REAC/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_filterREAC.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedREAC <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedREAC_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
summary
summary_list[[1]] <- num_enrichedGO
summary_list[[2]] <- num_enrichedBP
summary_list[[3]] <- num_enrichedGO_no
summary_list[[4]] <- num_enrichedBP_no
summary_list[[5]] <- num_enrichedREAC
combine_database_v
summary_list
for (combine_database in combine_database_v){
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,as.numeric(num_enriched_combo))
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
}
# ---- Plot Network ----
net_save_path=paste0(parent_save_path,version,'/net/')
if (!dir.exists(net_save_path)) {
dir.create(net_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_net.R",gpsnet_result_score_path,gpsnet_raw_input_path,net_save_path,trait_list,gpsnet_result_suffix)
system(cmd)
summary_df <- as.data.frame(t(do.call(rbind, summary_list)))
colnames(summary_df) <- c('GO','BP','GO_no','BP_no','REAC',combine_database_v)
summary_df$degP <- degP
summary_df$connP <- connP
summary_df$moduleCut <- cutoff
summary_df <- rownames_to_column(summary_df, var = "cellType")
all_summary_list[[length(all_summary_list) + 1]] <- summary_df
all_summary_df <- do.call(rbind, all_summary_list)
all_summary_df
write.csv(all_summary_df,paste0(parent_save_path,'summary.csv'))
