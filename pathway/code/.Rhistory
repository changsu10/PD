p2=ggraph(layout) +
geom_edge_link(aes(color = I(color)), width = 0.1) +
geom_node_point(aes(size = gene_confidence_score, color = pathway)) +
scale_color_manual(values=color_vector, breaks = reordered_levels)+
scale_size_continuous(range = c(5, 10)) +
geom_node_text(aes(label=symbol),size=3)+
theme_graph(base_family = "sans")+
guides(colour = guide_legend(override.aes = list(size=5)))
ggsave(paste0(plot_save_path,"network_",t,"_pathway.pdf"), plot = p2, device = "pdf", width = 15, height = 15)
# plot3: colored by pathway, all edges grey
p3=ggraph(layout) +
geom_edge_link(color='lightgrey',width=0.1) +
geom_node_point(aes(size = gene_confidence_score, color = pathway)) +
scale_color_manual(values=color_vector, breaks = reordered_levels)+
scale_size_continuous(range = c(5, 10)) +
geom_node_text(aes(label=symbol),size=3)+
theme_graph(base_family = "sans")+
guides(colour = guide_legend(override.aes = list(size=5)))
ggsave(paste0(plot_save_path,"network_",t,"_pathway_grey.pdf"), plot = p3, device = "pdf", width = 15, height = 15)
}
}
for (t in traits) {
# ---- Prepare Node and Edge ----
dfs_list=prep_net(t,
gpsnet_result_path,
gpsnet_raw_input_path,log2FC_var,gene_var,pval_var,padj_var,
is_label_pathway)
# ---- Plot Network ----
nodes=as.data.frame(dfs_list$node_score)
edges=dfs_list$filtered_df
plot_net(t,nodes,edges,is_label_pathway,color_by,log2FC_var)
}
dim(nodes)
setwd('/Users/manage/Desktop/Github/PD/pathway/code/')
# ---- Set Path ----
# gene module path
gpsnet_result_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/GPSnet//GPSnet_result_final/'
# save path
parent_save_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/pathway/'
# save version and suffix
#version='DEGs_lesion_vs_normal.psudobulk.default'
version=''
# traits (name of gene module result files)
#trait_list='B_cells_filtered,Dendritic_cells_filtered,Fibroblasts_filtered,Keratinocytes_filtered,Plasma_cells_filtered,Proliferating_cells_filtered,Sweat_gland_Myoepithelial_cells_filtered,T_cells_filtered'
trait_list='Keratinocytes'
# GO
save_path=paste0(parent_save_path,version,'/GO_nogoxplore_norevigo/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_nogoxplore_norevigo_filterGO.R",gpsnet_result_path,save_path,trait_list)
system(cmd)
setwd('/Users/manage/Desktop/Github/PD/pathway/code/')
library(tibble)
# ---- Set Path ----
degP=c(0.05)
connP=c(0.01)
cutoff=c(0.002)
combine_database=c('bp','reac','bp_no','go,reac','go_no,reac')
is_smooth=c('yesSmooth')
gpsnet_result_path0='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/GPSnet/GPSnet_result/'
gpsnet_result_score_path0='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/GPSnet/GPSnet_result_keep_score/'
gpsnet_raw_input_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/lesion_data/'
parent_save_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/pathway/degP0.05_con0.01_yesSmooth/'
trait_list='Fibroblasts_filtered,Keratinocytes_filtered,T_cells_filtered,B_cells_filtered'
all_traits=strsplit(trait_list,',')[[1]]
source("~/Desktop/chang_runGPSnet_08-09-2024/python/pathway/code/run_pathway_analysis_select_v2.R")
setwd('/Users/manage/Desktop/Github/PD/pathway/code/')
library(tibble)
# ---- Set Path ----
degP=c(0.05)
connP=c(0.01)
cutoff=c(0.002)
combine_database=c('bp','reac','bp_no','go,reac','go_no,reac')
is_smooth=c('yesSmooth')
gpsnet_result_path0='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/GPSnet/GPSnet_result/'
gpsnet_result_score_path0='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/GPSnet/GPSnet_result_keep_score/'
gpsnet_raw_input_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/lesion_data/'
parent_save_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/pathway/degP0.05_con0.01_yesSmooth/'
trait_list='Fibroblasts_filtered,Keratinocytes_filtered,T_cells_filtered,B_cells_filtered'
all_traits=strsplit(trait_list,',')[[1]]
all_summary_list <- list()
subfolder = paste0('degP',degP,'_conn',connP,'_',is_smooth)
gpsnet_result_path=paste0(gpsnet_result_path0,subfolder,'/')
gpsnet_result_score_path=paste0(gpsnet_result_score_path0,subfolder,'/')
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff)
version = paste0(subfolder,'_moduleCutoff',cutoff)
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
summary_list <- list()
gpsnet_result_suffix=paste0('_',cutoff)
version = paste0('moduleCutoff',cutoff)
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
# GO - no prune
save_path=paste0(parent_save_path,version,'/GO_nogoxplore_norevigo/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_nogoxplore_norevigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
# REAC
save_path=paste0(parent_save_path,version,'/REAC/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_filterREAC.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedREAC <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedREAC_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
summary_list[[1]] <- num_enrichedGO
summary_list[[2]] <- num_enrichedBP
summary_list[[3]] <- num_enrichedGO_no
summary_list[[4]] <- num_enrichedBP_no
summary_list[[5]] <- num_enrichedREAC
for (combine_database in combine_database_v){
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,as.numeric(num_enriched_combo))
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
# ---- Plot Network ----
net_save_path=paste0(parent_save_path,version,'/net_',combine_database,'/')
if (!dir.exists(net_save_path)) {
dir.create(net_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_net.R",gpsnet_result_score_path,gpsnet_raw_input_path,net_save_path,trait_list,gpsnet_result_suffix)
system(cmd)
}
combine_database_v=c('bp','reac','bp_no','go,reac','go_no,reac')
for (combine_database in combine_database_v){
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,as.numeric(num_enriched_combo))
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
# ---- Plot Network ----
net_save_path=paste0(parent_save_path,version,'/net_',combine_database,'/')
if (!dir.exists(net_save_path)) {
dir.create(net_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_net.R",gpsnet_result_score_path,gpsnet_raw_input_path,net_save_path,trait_list,gpsnet_result_suffix)
system(cmd)
}
summary_df <- as.data.frame(t(do.call(rbind, summary_list)))
colnames(summary_df) <- c('GO','BP','GO_no','BP_no','REAC',combine_database_v)
summary_df$degP <- degP
summary_df$connP <- connP
summary_df$moduleCut <- cutoff
summary_df <- rownames_to_column(summary_df, var = "cellType")
all_summary_list[[length(all_summary_list) + 1]] <- summary_df
all_summary_df <- do.call(rbind, all_summary_list)
write.csv(all_summary_df,'/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/pathway/summary_degP0.05_con0.01_yesSmooth.csv')
all_traits=c('updrs2','updrs3','schwab',#motor
'pigd_scores','tremor_scores','moca','benton','lns','hvlt','symbol_digit','semantic_fluency',#cognition
'gds', 'stai',#mood
'scopa',#Autonomic
'ess','rem',#sleep
'gco',#global
'total_tau','p_tau181p','alpha_syn','abeta_42'#biomarker
)
trait_list=paste(all_traits,sep=',')
trait_list
trait_list=paste(all_traits,collaspe=',')
trait_list
?paste
trait_list=paste(all_traits,collapse=',')
trait_list
setwd('/Users/manage/Desktop/Github/PD/pathway/code/')
library(tibble)
# ---- Set Path ----
combine_database_v=c('go','reac','kegg')
# ---- Set Path ----
combine_database_v=c('go','go_no','reac','kegg')
gpsnet_result_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_final/'
gpsnet_result_score_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_keep_score_final/'
#gpsnet_raw_input_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/lesion_data/'
parent_save_path='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/pathway/'
all_traits=c('updrs1','updrs2','updrs3','updrs4','schwab',#motor
'pigd_scores','tremor_scores',
'moca','benton','lns','hvlt','symbol_digit','semantic_fluency',#cognition
'gds', 'stai',#mood
'scopa',#Autonomic
'ess','rem',#sleep
'gco',#global
'total_tau','p_tau181p','alpha_syn','abeta_42'#biomarker
)
trait_list=paste(all_traits,collapse=',')
all_summary_list <- list()
gpsnet_result_path=gpsnet_result_path0
gpsnet_result_score_path=gpsnet_result_score_path0
summary_list <- list()
gpsnet_result_suffix=''
version = ''
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
save_path
version
parent_save_path
gpsnet_result_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_final'
gpsnet_result_score_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_keep_score_final'
gpsnet_result_path=gpsnet_result_path0
gpsnet_result_score_path=gpsnet_result_score_path0
summary_list <- list()
gpsnet_result_suffix=''
version = ''
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
save_path
parent_save_path
#gpsnet_raw_input_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/lesion_data/'
parent_save_path='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/pathway'
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
save_path
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
trait_list
save_path
gpsnet_result_path
gpsnet_result_score_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_keep_score_final/'
#gpsnet_raw_input_path='/Users/manage/Desktop/chang_runGPSnet_08-09-2024/python/lesion_data/'
parent_save_path='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/pathway'
all_traits=c('updrs1','updrs2','updrs3','updrs4','schwab',#motor
'pigd_scores','tremor_scores',
'moca','benton','lns','hvlt','symbol_digit','semantic_fluency',#cognition
'gds', 'stai',#mood
'scopa',#Autonomic
'ess','rem',#sleep
'gco',#global
'total_tau','p_tau181p','alpha_syn','abeta_42'#biomarker
)
trait_list=paste(all_traits,collapse=',')
all_summary_list <- list()
gpsnet_result_path=gpsnet_result_path0
gpsnet_result_score_path=gpsnet_result_score_path0
summary_list <- list()
gpsnet_result_suffix=''
version = ''
# ---- Run pathway enrichment on 3 databases: GO, REAC, KEGG ----
# GO
save_path=paste0(parent_save_path,version,'/GO/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
cmd
gpsnet_result_score_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_keep_score_final/'
gpsnet_result_path=gpsnet_result_path0
gpsnet_result_score_path=gpsnet_result_score_path0
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
cmd
gpsnet_result_path
gpsnet_result_path=gpsnet_result_path0
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
cmd
gpsnet_result_path
gpsnet_result_path=gpsnet_result_path0
gpsnet_result_path
gpsnet_result_path0
gpsnet_result_path0='/Users/manage/Desktop/amp_pd_cleaned_results/genetic/GPSnet/GPSnet_result_final/'
gpsnet_result_path=gpsnet_result_path0
gpsnet_result_path
system(cmd)
gpsnet_result_path
save_path
trait_list
gpsnet_result_suffix
gpsnet_result_suffix='.txt'
cmd <- paste("Rscript gprofier_goxplore_revigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedGO
num_enrichedBP <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP
# GO - no prune
save_path=paste0(parent_save_path,version,'/GO_nogoxplore_norevigo/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_nogoxplore_norevigo_filterGO.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedGO_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedGO_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedBP_no <- sapply(all_traits, function(t) {
file_path <- paste0(save_path,'BP/', t, '_enrichedBP_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedGO_no
# REAC
save_path=paste0(parent_save_path,version,'/REAC/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_filterREAC.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
# save enriched number
num_enrichedREAC <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedREAC_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedREAC
# KEGG
save_path=paste0(parent_save_path,version,'/KEGG/')
if (!dir.exists(save_path)) {
dir.create(save_path, recursive = TRUE)
}
cmd <- paste("Rscript gprofier_filterKEGG.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
cmd
cmd <- paste("Rscript gprofier_filterKEGG.R",gpsnet_result_path,save_path,trait_list,gpsnet_result_suffix)
system(cmd)
system(cmd)
# save enriched number
num_enrichedKEGG <- sapply(all_traits, function(t) {
file_path <- paste0(save_path, t, '_enrichedKEGG_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
num_enrichedKEGG
summary_list[[1]] <- num_enrichedGO
summary_list[[2]] <- num_enrichedBP
summary_list[[3]] <- num_enrichedGO_no
summary_list[[4]] <- num_enrichedBP_no
summary_list[[5]] <- num_enrichedREAC
summary_list[[6]] <- num_enrichedKEGG
combine_database_v
combine_database='go'
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
#summary=rbind(summary,as.numeric(num_enriched_combo))
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
# ---- Set Path ----
combine_database='go,reac,kegg'
# ---- Set Path ----
combine_database='go,reac,kegg'
#---- Combine output files into one file ----
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
if (!dir.exists(combined_save_path)) {
dir.create(combined_save_path, recursive = TRUE)
}
cmd <- paste("Rscript combine_filtered.R",combined_save_path,trait_list,combine_database)
system(cmd)
# save enriched number
num_enriched_combo <- sapply(all_traits, function(t) {
file_path <- paste0(combined_save_path, t, '_enrichedPathway_filtered.tsv')
num <- as.numeric(sub("^\\s*([0-9]+).*$", "\\1",system(paste("wc -l", file_path), intern = TRUE)))
num - 1
})
summary_list[[length(summary_list) + 1]] <- as.numeric(num_enriched_combo)
# ---- Plot Bubble Plot ----
top_num=100
combined_save_path=paste0(parent_save_path,version,'/combined_',combine_database,'/')
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
top_num=50
bubble_save_path=paste0(parent_save_path,version,'/bubble_',combine_database,'/T',top_num,'/')
if (!dir.exists(bubble_save_path)) {
dir.create(bubble_save_path, recursive = TRUE)
}
cmd <- paste("Rscript plot_bubble.R",combined_save_path,bubble_save_path,trait_list,top_num,20,12)#h,w
system(cmd)
summary_df <- as.data.frame(t(do.call(rbind, summary_list)))
summary_df
summary_df=summary_df[,-7]
summary_df
colnames(summary_df) <- c('GO','BP','GO_no','BP_no','REAC','KEGG','GO+REAC+KEGG')
summary_df <- rownames_to_column(summary_df, var = "Trait")
summary_df
parent_save_path
write.csv(summary_df,paste0(parent_save_path,'/summary_pathway.csv'),row.names = F, quote = F)
